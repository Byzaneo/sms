sudo: required
language: java
jdk: oraclejdk10
services:
  - docker

cache:
  directories:
    - "$HOME/.m2/repository"
env:
  global:
    - secure: ZJvL\/pAEiNPbBszGNvWKK6qfWdBUztb9RME+2fNmKBfqpVkKWuBvPDUEtqb3VXJBCBy6TMXGFfeaxplYXtuM+azzvGYe9RMEuyUVm+QW1yYrUciwioRJSFzGH0g5wjIXRBajF9nivVswsyxCf23Zp4a+HNsnt\/pseFeXWETjLSFbO\/lVdWAJMZOFRPT2PR7TPrQ+Oy7pFrdbwinRblhxV31XDyrkEwdR6VEbb31tt1DOOnD511jw9CCmzJmqKcpqg3q7Q5CBes0ljSk9vFRmhSKQnmKHo6L0\/f3JBkw9IKix6kN05VPZKnfn8F1IvqhF30Ssnozl\/Wq4sc2owemJq0Cyit5OHtBGtlzIYNmu\/0UgYUPCwgT76+ilGh5vbNHex6TmnRhEeKP5c3YT35fZv2li1lZNxqxOg55WMEm76D3bfscQa8Lq75nl7gl0zvBrSpcEBdFkAiHPoyQk4JF2U+nZa6cM8lj2gLg22q1xGYu7qnbiRTtd3qEl3I+lS1IpsIsV7R9ePrUHMuX1tsIgII5CsfbdsO1ztT9gU7ALYr6quK0tC7NQhT0dDaqvi+s1TT09nB2Rnf8h86ui0dRwvhT1tD\/Yq2\/tLVnGL5ehJfZ\/2bczASL8JAOPSy3Wq40YVfgX1O72ni\/WPPj0DXH7wWgyHEsK8MiLBVzlV40oBTk=
    - secure: eznoeth+AsK57TUX1xfkIQTa5xTFhCYk8jHAJCqQpVIqMrYyqsUAuTLEzEPigU+AG2rjP41p+Jt+9V5PmRweSLd1B88uhRa2eYn2KocNasZKP2p3EaR\/GiQrdGq6MbWxGqlMQfD5sWj1Zrq7d3ZDgwizvMGKHG9mvSMFQK8J7ERgjttxUm9z5rjXPslCMpHbcdbMS3zHx\/GvZ0xrAAKl5IpSWfdK4hDny1\/vkJY45eWJDYyGjXXlI+XJbAzP67kycyTWxh50Y8EOWdnIdlQiuen3ThmA2oJ09upzaUmJA30UwWEhKwSriW5Yrd5TMUO6MZ2XA3tYP\/EibnvtpBj3\/007JWMcxXvDSw0m9XV2jGb8Uo\/UyVPKrZYWdIlSNu5jEfHWro0o58F\/me3Qc5z6n5t78pLPB0uND8tI+75SQAOqg2JvVU9LcRAANXryuAoChYMNYTeA9lBOWoRZZJwbQqN0\/fqnuJNhSYJLRwkiwUIO\/sY2QOYFMlPLGly5zvqusjh9B37g5BvwKsfSzmxearLS\/HRxC81k9sWG8Oi8HHM8DEPFTCz+BZkoifaf9t\/2GBmixkmF4IXsd7dcnkNxbVbQKRza9IPFNm4s073v6Aflz9\/7punghHvTFqHEnarcdnm0dKvZEZo92lWQI+pgis3uPLSaLw4zJc2HhidbH5o=
    - secure: s9NPmGJcfkMrMeoIpHlbV6JrfyFZqDO0RPyFQuSto2pxST++dZwGrtLce5XMn16YkE55Y8sAdYTORfM2qS1G+U+AFl2\/5YhTgPVwfQ1\/QcflmNW5Xhc\/Tn8vO\/orQmsiFzGxWcqpl9sXRmHm48lzpFaLcsoe\/Qv0rH\/pcngnTELI29+fKGbjqat3ScYTKfJSqYu7PqCE9U2qb+Wk2Y9RaAILNaBWFDZ6GBo\/CvHHltZLaLRFN22DmcIb1b5NUY1jFdcfMJVVsv5v07xrL7zwtkrBqqHzalXcr5yjzY4C0MryHGFPArjc3ZKmYzTp+Zwt130d84OaMfxobTjRfi4w+Tl8gqXFX2n6OWvj5\/hKTBpHqpznNh0\/XF3v1tWUL9ledXWLCpqViy83ePfh7YIhxFdRWwZIeSxuK2UPrbG6z2x160NKIes\/rXaQySqgWYPE8dyptdbhLMT3zkoLjjV3OPfxjqiGt2WH5qWva3rnWUrLnWHOA0T7awFmsraQXEF9JQvtInjOrNkWGwR\/EtQnAF2eaVqmM6QW\/zv23P6KZSeLDawPWdC4LL3AS1BNKE2fL7xELOP0m\/sYzaTAO4Tkj7DVh2305s6THY1Oz3e3neeERG+4GL82E+nsv6QrKVPkrBSjcPVBKYrxd0lce0TI8Ajxi1krZbvpSnciWC2S32I=
    - secure: FL3QLSXi\/sv33Za0pIiCf49u+WS3q8WyiPsa2jPWkzAzLNpTZB9vJCNPy9NXDoFbvgCK71bCF0F0S\/k2s1tVdGQl2Fwmol+YDi3\/tnDV8xJCxWo\/B722K4azJzU84Bm7AMBmV5FKbnEhZGqzs92QVKRacqVxSmSYIhKfUwQOqpDFYxxxBNDF5BfxKvLmmBSjhqxS1UXB+LnrID3lMoxaEq6XBnh2zm7EjIEi9dKgVd4nE8KnH7f\/ZRMbfIGdUNgC0yKrcyf8SWD31qngF2p+zNFJxFs1F6zA9RcZwEhZ9XFsc\/n7W3iEcYUImUXRiB4agT1c7odaGk5WIVL0YlRDdFUH+puCTpJyERFSJZDtLm98+8R3hZA3dMZpP7UkQoWvW6pAOyxX+glhmbmRRAyqqMeL+2+cPCl1+q0WgMiGYqDX5\/nUyADasOPFTHlVL4oSN\/\/O6yAy66Ykk+rR3cQI8kuTHf2DnMeY9xYRPw4vXtjX1ZiEs2168iE68ztZdnYvaUBmrNWSNfwVm2PmHAwvA9kNOLlAJr\/VC\/wWJ1CKP+A+YfpYRDrRSXZru\/Q\/4emMEgj0FsFq0A9itac9uhI+h3hq4QUx68MbH9CHFCyFIgSwYcZXD3rCoOJJ2FRjPm+vtEtROMvciGAAMkbKxNz+7QuLQh1vP5HS0QMTPYgVkRE=
    - secure: YjpTgs1crbZHzQuaEh7H5oMlb6FrkLrtWl+QoTyZaFk0ehGBjwX4kliseTkBodvIbsYjXbJCWjWlkyy\/zRibJjMo69C801\/Y8zmBGnWPRPCNY58gOEM9Tu6rKq1\/5FZiBjOcFyK7dhgRbc5L6tpCiWHLe+t8GzodklvegMsRLy5e8ici\/vTbk2uYdSZZmLiOix3EBGJDq1WR4mxhKuW+M1D+5NTZI7H9rd8PdNdpOHpFZZKeocFoH6rZOFTbGM9qrZoMeyMVTCKNuYmIQQJSN2rIS51F8FRFev45iCtBToG4mJMg4gieLZWXavX5rmKzmBKURWpsu6hHTDH3yVpvL1XGp2g8MpD9v4ZZrdqOmtjFt7AlzXVBPeUmuTfYgTwexwrNfmrr8ZZVByVcvEBLh7LdsyTeSqLqXYlWMO3xMLuWAetVofygIJT0y8RyodhRq1UlV8NarD1m+QeWh2hnDFvestOWYdDguTYX+f9rOMmQXL2ahzIVihXw6clfaAmiAKKms3faj5D0zbatMhrTYbeDqW43j0n6gqDtTvsMcD1+GTv0kXHHtNt3lOBU8s1tkGYA0fqVmhzlpqhcGGWXAzEo8OoWnG\/gjNcQXh+hy4sJY5br9giI1bwh9Vge6DBueO\/mhiY3hblh+ifZZrwCCvcYmvtM91ZLLEa0BPRxnXg=

before_install:
  - git clone https://sources.byzaneo.com/scm/one/maven.git target

install:
  - mvn package -U -B -P prod,coverage --settings target/travis/settings.xml

after_success:
  - bash <(curl -s https://codecov.io/bash)
  - docker login -u $BYZANEO_USERNAME -p $BYZANEO_PASSWORD repository.byzaneo.com
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH;
    fi`
  - export IMAGE_NAME=repository.byzaneo.com/sms
  - docker build -t $IMAGE_NAME:$COMMIT .
  - docker tag $IMAGE_NAME:$COMMIT $IMAGE_NAME:$TAG
  - docker push $IMAGE_NAME
